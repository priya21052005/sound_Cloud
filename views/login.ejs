
<div class="login-container">
  <div class="login-card">
    <h2>üîê Login</h2>
    <form method="POST" action="/login" class="login-form">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" placeholder="Email" required value="<%= typeof email !== 'undefined' ? email : '' %>" class="form-input">
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="Password" required class="form-input">
      </div>

      <div class="form-group checkbox-group">
        <input type="checkbox" id="rememberMe" class="checkbox-input">
        <label for="rememberMe" class="checkbox-label">Remember me (saves credentials locally)</label>
      </div>

      <button type="submit" class="btn-login">Login</button>
    </form>

    <% if (typeof error !== 'undefined' && error) { %>
      <div class="error-message" id="errorMessage">
        <span class="error-icon">‚ùå</span>
        <span class="error-text"><%= error %></span>
        <% if (typeof lockTtl !== 'undefined' && lockTtl) { %>
          <div id="lockTimer" style="margin-left:auto; font-weight:700; color:#ffdede">Lock: <span id="lockSeconds"><%= lockTtl %></span>s</div>
        <% } %>
      </div>
    <% } %>

    <p class="auth-link">Don't have an account? <a href="/register">Register here</a></p>
  </div>
</div>

<style>
  .login-container { display:flex; justify-content:center; align-items:center; min-height:calc(100vh - 200px); padding:20px }
  .login-card { background:#0f0f10; border-radius:12px; padding:28px; width:100%; max-width:420px; color:#fff }
  .form-group { margin-bottom:12px }
  .form-input { width:100%; padding:10px; border-radius:6px; border:1px solid #333; background:#111; color:#fff }
  .btn-login { width:100%; padding:10px; border-radius:6px; background:#1DB954; border:none; color:#fff; font-weight:600; cursor:pointer; transition:all 0.3s }
  .btn-login:hover { background:#1ed760; transform:scale(1.02) }
  .error-message { margin-top:12px; padding:10px; background:rgba(255,70,70,0.08); border-left:4px solid #ff4646; border-radius:6px; display:flex; gap:8px; align-items:center }
  .error-text { color:#ffb3b3 }
  .auth-link { margin-top:12px; color:#bfbfbf }
  
  .checkbox-group { display:flex; align-items:center; gap:8px; margin-bottom:18px }
  .checkbox-input { width:18px; height:18px; cursor:pointer; accent-color:#1DB954 }
  .checkbox-label { font-size:13px; color:#b3b3b3; cursor:pointer; user-select:none }
  .checkbox-label:hover { color:#fff }
</style>

<script>
  // ===== AUTO-FILL & REMEMBER ME FUNCTIONALITY =====
  
  // Auto-fill credentials from localStorage on page load
  window.addEventListener('DOMContentLoaded', () => {
    const savedEmail = localStorage.getItem('soundcloud_email');
    const savedPassword = localStorage.getItem('soundcloud_password');
    const savedRemember = localStorage.getItem('soundcloud_remember') === 'true';
    
    const emailInput = document.getElementById('email');
    const pwdInput = document.getElementById('password');
    const rememberCheckbox = document.getElementById('rememberMe');
    
    // Auto-fill if saved credentials exist
    if (savedEmail) emailInput.value = savedEmail;
    if (savedPassword) pwdInput.value = savedPassword;
    if (savedRemember) rememberCheckbox.checked = true;
  });
  
  // Save credentials when form is submitted (only if "Remember me" is checked)
  document.addEventListener('submit', (e) => {
    if (e.target.classList.contains('login-form')) {
      const emailInput = document.getElementById('email');
      const pwdInput = document.getElementById('password');
      const rememberCheckbox = document.getElementById('rememberMe');
      
      if (rememberCheckbox.checked) {
        localStorage.setItem('soundcloud_email', emailInput.value);
        localStorage.setItem('soundcloud_password', pwdInput.value);
        localStorage.setItem('soundcloud_remember', 'true');
      } else {
        // Clear saved credentials if unchecked
        localStorage.removeItem('soundcloud_email');
        localStorage.removeItem('soundcloud_password');
        localStorage.removeItem('soundcloud_remember');
      }
    }
  });
  
  // ===== REAL-TIME LOCKOUT COUNTDOWN =====
  (function(){
    const lockSecondsElem = document.getElementById('lockSeconds');
    const submitBtn = document.querySelector('.btn-login');
    const pwdInput = document.getElementById('password');
    const emailInput = document.getElementById('email');
    let remaining = lockSecondsElem ? parseInt(lockSecondsElem.textContent, 10) : 0;

    function disableForm(disabled){
      if(submitBtn) submitBtn.disabled = disabled;
      if(pwdInput) pwdInput.disabled = disabled;
      if(emailInput) emailInput.disabled = disabled;
      if(submitBtn) submitBtn.style.opacity = disabled ? '0.6' : '1';
    }

    if(remaining > 0){
      disableForm(true);
      const interval = setInterval(()=>{
        remaining -= 1;
        if(lockSecondsElem) lockSecondsElem.textContent = remaining;
        if(remaining <= 0){
          clearInterval(interval);
          // re-enable form and remove lock message
          disableForm(false);
          const lockTimer = document.getElementById('lockTimer');
          if(lockTimer) lockTimer.parentNode.removeChild(lockTimer);
        }
      }, 1000);
    }
  })();
</script>
